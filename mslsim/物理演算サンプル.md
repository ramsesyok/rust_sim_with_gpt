# 役割
Rustの関数型プログラミングに精通したプログラマとして、C/C++からRustの導入を検討している会社へのコンサルタントとして、ふるまってください。

# 目的
- Rustプログラムの数値演算プログラムにおける適用可能性を調査することが目的です。
- 複雑な物理現象の再現は不要ですが、十分な量の複雑な数値演算を含むことが必要です。
- 例題として中距離弾道ミサイルの物理シミュレーションプログラムを採用してください。

- まずは、数値演算の仕様書をまとめてください。


#  演算概要
## 全般
1. XYZ空間での演算を行うこと。 Z軸は鉛直方向上固定、右手系（X軸東、Y軸北）
2. 演算サイクルは、変数dt (s)として置き、デフォルトは、0.1sとすること。
3. このシミュレーションには、３つの演算モデルが登場する。
   - 中距離弾道ミサイル
   - 中距離弾道ミサイルの探知用レーダ
   - 迎撃ミサイル
4. これらの演算モデルは、シナリオによって、複数個出現すること。
   - 演算モデルがシミュレーション上に登場した際のインスタンスを「オブジェクト」と呼ぶ。
6. いずれのミサイルも姿勢角演算においてロールの影響はないものとして簡易化すること。
   - ただし、変数上ロールも考慮するが、常にゼロとすること。
## 設定ファイルについて
1. 各演算モデルの固定的な性能諸元は、モデルごとのパラメータファイルから読み込むこと。
2. 各オブジェクトの初期位置・初期姿勢などは、パラメータファイル群とは別の「シナリオファイル」から読み込むことと
3. 各設定ファイルは、yaml形式で記述すること。

## 出力結果について
1. 出力結果として、各サイクルの中距離弾道ミサイルと迎撃ミサイルの位置と姿勢角、レーダの探知状況および探知位置をCSVファイルとして出力すること。
2. csvのヘッダには、変数名とともに単位を記載すること。

## 演算全般
1. 必要に応じて、ローパスフィルタを用いて振動を防いでください。


## 中距離弾道ミサイル
1. 演算期間は、発射から地表（z=0）に到達するか、迎撃ミサイルによって、迎撃されるまで計算を行こと。
2. 大気密度による影響を考慮にいれること。
3. 燃料減少による重量変化を考慮にいれること。

## 中距離弾道ミサイルの探知用レーダ
1. レーダは方位角・仰角および探知距離を性能諸元として持つこと。
2. 探知周期は、0.1sとすること。
3. レーダの探知距離内に中距離弾道ミサイルが入ったら、迎撃ミサイルへの発射指示を出すこと。
4. 探知している間、迎撃ミサイルに位置を通知すること。

## 迎撃ミサイル
1. 中距離弾道ミサイルを迎撃するか、地表に(z=0)に到達するまで演算すること。
2. レーダから受信した弾道ミサイルの位置への誘導は比例航法を用いること。

## 汎用演算
- 汎用演算は、一つのモジュールにまとめること。
- 積分法は、Adams-Bashforth法（2段法）を用いること。
   - $ (\frac{dy}{dx} = f(x)), (y(a) = 0) $ として ODE を解くこと。
- atan2において、入力がゼロのときはエラーを検出できる共通処理を作成すること。
  - ゼロ判定は、単純比較でなく、許容誤差以下であることを判定条件とすること。

# 制約
- 各演算仕様は、各処理ごとに数式をきちんと記載し、実装にミスが起きないようにすること。
- 数値計算部分に関してはcrateを多用せず、実装すること。
- プログラムの実装にあたっては、関数型プログラミングの原則に厳密に即すること。
   - ただし、可読性を重視し、汎用演算のうち積分計算・フォーパスフィルタは、ステートフルなオブジェクトに前回値を保持する構造とすること。

------

ここまでの仕様をもとにソフトウェアの基本設計を行ってください。

# 条件
1. 基本設計以下が明確になること。
  - プログラムのファイル構成
  - 各処理のインタフェース
  - 設定ファイルのデータ構造
2. 関数型プログラミングの原則を厳密に順守すること。
3. モジュール構成は、汎用演算(math)とシミュレーション（models）の２つのモジュールを作成し、別プログラムで流用できるようにすること。
4. ファイル構成およびモジュール構成を明確にすること。
5. 積分計算・ローパスフィルタなど汎用的な演算は、運動演算と切り離し汎用的に使えるようにしてください。
  - 可読性を重視し、汎用演算のうち積分計算・フォーパスフィルタは、ステートフルなオブジェクトに前回値を保持する構造にすること。。

# 対象
Rust初心者のプログラマが、迷わないようモジュールやデータ構造を記載してください。
